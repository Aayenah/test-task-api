const express = require('express');

const router = express.Router();
const data = require('../data/CVE.json');

/**
 * Get a list of all CVEs
 * @route GET /api/cves
 * @group CVEs - CVE operations
 * @returns 200 - CVE JSON object
 */
router.get('/', (req, res) => {
  res.json(data);
});

/**
 * Get an array of years that exist in CVEs
 * @route GET /api/years
 * @group CVEs - CVE operations
 * @returns 200 - { years: [2012, 2013]}
 */
router.get('/years', (req, res) => {
  const yearSet = new Set(); // unique values only
  data.CVE_Items.forEach((i) => {
    const date = new Date(i.publishedDate);
    const year = date.getFullYear();
    yearSet.add(year);
  });
  const yearArray = Array.from(yearSet); // convert Set to Array
  yearArray.sort((a, b) => a - b); // sort ascending
  res.send({ years: yearArray });
});

module.exports = router;
